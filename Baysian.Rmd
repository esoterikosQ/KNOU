---
title: "Untitled"
author: "Q"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## L2

$[-\pi, \pi]$ 범위에서 x, y가 변할 때 $\frac{cos(y)}{1+x^2}$ 값을 등고선으로 표현하는 그래프를 그리는 코드

```{r 2.1.2.}
x <- seq(-pi, pi, len=50)
y <- x
f <- outer(x,y,function(x,y) cos(y)/(1+x^2))
contour(x,y,f)
contour(x,y,f,nlevels=15, add=TRUE)
```

### 이항모형 실습

- 모형 : $X \sim B(n, \theta), \ \theta \in (0,1)$
- 사전분포 : $\theta \sim Beta(\alpha, \beta), \ \alpha, \beta > 0$
- 사후분포 : $\theta | x \sim Beta(\alpha+x, \beta+n-x)$

```{r 2.2.1.}
# alpha, beta = 1
alpha = 1
beta = 1
# 문제에서 주어진 조건
n = 10
x = 3

# vector calculation
# 모형에서 확률변수의 분포를 결정할 수 있는 모수값을 theta로 표현
theta = seq(from=0, to=1, length=100)
# 데이터가 없는 상태의 사전분포함수 표현 - pdf
prior.den = dbeta(theta, alpha, beta)
# 데이터가 있는 상태의 사후분포함수 표현 - pdf
post.den = dbeta(theta, alpha+x, beta+n-x)
# theta값의 변화에 다른 우도값 벡터
likelihood = dbinom(x, size=n, prob=theta)
# 우도값을 백분율로 표현
likelihood = 100*likelihood/sum(likelihood)

# plot : theta값에 따른 사전분포, 우도, 사후분포 변화를 각각의 척도에 따른 별도 그래프로 표현
par(mfrow=c(2,2))
plot(theta, prior.den, type='l', ylab='prior density')
plot(theta, likelihood, type='l', ylab='likelihood')
plot(theta, post.den, type='l', ylab='posterior density')
par(mfrow=c(1,1))

# plot2 : theta값에 따른 사전분포, 우도, 사후분포 변화를 단일 척도에 다른 하나의 그래프로 표현
ymax = max(prior.den, likelihood, post.den)
plot(theta, post.den, type='l', ylab='density', ylim=c(0,ymax))
lines(theta, prior.den, col='magenta')
lines(theta, likelihood, col='cyan')
legend(0.6, 2.8, c('posterior','prior','likelihood'), lty = c(1,1,1),
       lwd=c(2.5, 2.5), col=c('black','magenta','cyan'))
```

### 점추정, 구간추정

- 사후분포의 평균, 중앙값, 최빈값, 표준편차, 2.5%와 97.5% 백분위수는?
- 사후분포의 밀도함수와 위에서 구한 값을 밀도함수 위에 그리시오

```{r 2.2.2.}
# 추정
post.summary=numeric(6)
names(post.summary) = c('post mean', 'post median', 'MAP', 'post sd', '2.5%', '97.5%')
post.summary['post mean'] = (alpha+x)/(alpha+beta)
post.summary['post median'] = qbeta(0.5, alpha+x, beta+n-x)
post.summary['MAP'] = (alpha+x-1)/(alpha+beta+n-2)
post.summary['post sd'] = sqrt((alpha+x)*(beta+n-x)/((alpha+beta+n)^2*(alpha+beta+n+1)))
post.summary['2.5%'] = qbeta(0.025, alpha+x, beta+n-x)
post.summary['97.5%'] = qbeta(0.975, alpha+x, beta+n-x)
post.summary

# plot
plot(theta, post.den, type='l', ylab='density', ylim=c(0,ymax))
xpts1 = seq(f=post.summary['2.5%'], t=post.summary['97.5%'], len=100)
xpts = c(xpts1, xpts1[100:1])
ypts1 = dbeta(xpts1, alpha+x, beta+n-x)
ypts = c(rep(0,100), ypts1[100:1])
polygon(x=xpts, y=ypts, col='cyan4', border=NA, fillOddEven=T)
lines(x=rep(post.summary['post mean'], 2),
      y = c(0, dbeta(post.summary['post mean'], alpha+x, beta+n-x)),
      col='magenta')
lines(x=rep(post.summary['post median'], 2),
      y = c(0, dbeta(post.summary['post median'], alpha+x, beta+n-x)),
      col='magenta4')
lines(x=rep(post.summary['MAP'], 2),
      y=c(0, dbeta(post.summary['MAP'], alpha+x, beta+n-x)), 
      col='maroon')
legend(0.5, 2.8, c('posterior mean', 'posterior median', 'MAP', '95% conf int'),
       lty=c(1,1,1,1), lwd=c(2.5, 2.5, 2.5, 5),
       col=c('magenta', 'magenta4', 'maroon', 'cyan4'))
```


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
