---
title: "Untitled"
author: "SeungGyu Bak"
date: "2022-10-18"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## South Africa Heart Disease 데이터는 남아프리카의 심장병 고위험 지역에서 조사한 성인 남성 462명의 데이터이다.

```{r 1-a}
library(dplyr)
sah0 <- read.table('http://www-stat.stanford.edu/~tibs/ElemStatLearn/datasets/SAheart.data', sep = ',', head = T, row.names = 1)

sah <- sah0 %>% mutate(
  BMI.group = cut(obesity, breaks = c(10, 25, 30, 50),
                  label = c('normal', 'overweight', 'obese'))
  ) %>%
  mutate_at(vars(BMI.group, chd, famhist), as.factor)
```



### B. 변수. chd는 관상동맥질환 여부를, 변수 famhist는 가족력을 나타낸다. 이 두 변수가 서로 관련이 있는지 알맞은 가설검정을 수행하고 결과를 해석하시오.
  
  
chd와 famhist 변수 간의 연관성을 살펴보기 위해 오즈비와 카이제곱검정을 이용할 수 있다.
  
오즈비를 이용하는 경우, 두 변수 간에 연관성이 없으면 오즈비는 1이 될 것이다. ($H_0 : OR = 1$) 주어진 데이터를 바탕으로 분할표를 작성하고 오즈비를 계산한 결과, 오즈비는 3.2188로 계산되어, 가족력이 없는 사람의 경우 관상동맥질환이 없을 오즈가 가족력이 있는 사람에 비해 약 3배 이상인 것을 알 수 있다. 해당 오즈비의 95% 신뢰구간은 (2.1611, 4.794)로 계산되어 95% 신뢰수준에서 오즈비의 차이가 0보다 크다는 것을 확인할 수 있다. 따라서 두 변수 간의 독립성을 가정한 귀무가설을 기각하고, 두 변수 간에는 양의 연관성이 있다고 결론내릴 수 있다.  
  
```{r 1-b-1}
attach(sah)
#분할표 생성
con.t <- table(famhist, chd)
con.t
```
  
$$
odd = \frac{206 \times 96}{96 \times 64} = 3.2188
$$
  
```{r 1-b-4}
# 95% 신뢰구간 계산
library(epitools)
con.t.mat <- as.matrix(con.t)
result <- oddsratio(con.t.mat, method = 'wald')
result$measure
```
  
  
한편 동일한 가설검정을 카이제곱 검정을 통해서도 할 수 있다. 분할표의 각 기대도수와 실제도수 간의 차이를 기반으로 계산한 통계량이 대표본($n_i > 5$)에서 카이제곱 분포에 근사한다는 가정을 이용한 것으로, 연속성에 대한 가정을 강화하기 위해 예이츠의 보정을 병행하였다. 검정 결과는 아래와 같으며, p값은 <0.001로 계산되어 두 변수 간의 독립성을 가정하는 귀무가설을 기각하고 두 가설 사이에는 연관성이 있다는 결론을 내릴 수 있다.
  
```{r 1-b-3}
# 카이제곱 검정
chisq.test(con.t)
```
  
  
### C. 변수 sbp는 수축기 혈압을, 변수 age는 나이를, 변수 BMI.group은 비만도 그룹을 나타낸다. sbp를 결과변수(종속변수, 반응변수)로 하고, age, famhist, BMI.group을 독립변수(설명변수)로 하는 중선형회귀분석을 수행하시오. 적합된 회귀식은 무엇인가?
  
sbp를 결과변수로 하고 age, famhist, BMI.group을 독립변수로 하는 중선형회귀모형을 적합한 결과는 아래와 같다. 

```{r c}
fit <- lm(sbp ~ age + famhist + BMI.group)
summary(fit)
```
  
적합한 결과에 따라 도출된 모형식은 아래와 같다.
  
$$
Y = \beta + \beta_{age}AGE + \beta_{famhist}FH + \beta_{overweight}OW + \beta_{obes.}OBES 
= 114.3805 + 0.4917age - 0.7448FM + 4.9718OW + 7.4086OBES
$$
  
Y는 수축기 혈압(sbp)이고, 나이에 대한 회귀계수는 0.4917, 범주형 변수인 가족력 여부에 대한 회귀계수는 -0.7448, BMI에 따른 범주형 변수 중 과체중에 대한 회귀계수는 4.9718, 비만에 대한 회귀계수는 7.4086으로 나타났다.
  
위 모형을 해석하면, 다른 변수가 동일할 때에 나이가 1살 많아짐에 따라 수축기 혈압이 0.4917 올라간다. 가족력이 있는 사람은 그렇지 않은 사람에 비해 수축기 혈압이 0.7448 낮고, 과체중인 사람은 그렇지 않은 사람에 비해 4.9718, 비만인 사람은 정상인 사람에 비해 7.4086 혈압이 높을 것으로 예상할 수 있다.
  
전체 모형의 p값은 < 0.001로 귀무모형과 비교했을 때에 회귀모형은 유의미한 것으로 해석할 수 있다. 각 회귀계수의 p값은 유의수준 0.05에서 회귀계수가 0이라는 귀무가설을 기각할 수 있는 것으로 나타났지만, 가족력 변수의 경우 p값이 유의수준을 넘지 못하는 것으로 나타났다.
  
  
### D. C에서 구한 회귀식의 회귀계수들의 95% 신뢰구간과 p값을 구하시오.

```{r 1-d}
confint(fit)
```
  
각 회귀계수들의 95% 신뢰구간은 위와 같다. 95% 신뢰수준에서 모든 회귀계수는 0을 초과하는 것으로 나타나지만, 가족력 변수의 경우 회귀계수의 95% 신뢰구간이 0을 포함하는 것으로 나타나 회귀계수가 0이라는 귀무가설을 기각할 수 없는 것으로 나타난다.   
이와 같은 결과는 각 회귀계수의 p값을 통해서도 확인할 수 있다. 즉, 각 변수의 p값은 나이는 < 0.001, 가족력은 0.6845, BMI 각 범주는 0.0127, 0.0052로, 유의수준 0.05에서 가족력을 제외한 다른 변수는 0.05에 미치지 못한다.
  
  
### E. C에서 구한 회귀식을 해석할 때, 나이가 40세인 사람에 비해서 50세인 사람의 수축기 혈압은 평균적으로 얼마나 더 높다고 할 수 있는가? (가족력과 비만도 그룹은 모두 같다고 가정한다.)
  
나이의 회귀계수 추정치는 0.4917로, 나이가 1살 많아질 때에 수축기 혈압은 0.4917 높아질 것으로 예상할 수 있다. 따라서, 나이가 10살 많은 사람의 수축기 혈압은 그렇지 않은 사람에 비해서 4.917 높을 것으로 예상할 수 있다.
  
  
### F. C에서 구한 회귀식을 해석할 때, 비만도가 정상(normal)인 사람에 비해서 비만(obese)인 사람은 수축기 혈압이 평균적으로 얼마나 더 높다고 할 수 있는가? (나이와 가족력은 모두 같다고 가정한다.)
  
BMI 변수 중 비만 범주의 회귀계수는 7.4086으로 계산되었다. 따라서, 다른 변수가 모두 동일할 때에 비만인 사람의 수축기 혈압은 정상인 사람에 비해서 7.4086 높을 것으로 예상할 수 있다.
  
  
## 2. 다이어트 보충제의 효능을 알아보기 위해 무작위 배정 임상시험을 하려고 한다. 연구대상자는 등록시점의 체중을 측정한 후, 치료군은 다이어트 보조제를, 대조군은 위약(placebo)을 3개월간 각각 복용 후 다시 한 번 체중을 측정한다. 3개월 간 체중 감소량의 평균이 치료군은 2kg, 대조군은 0kg일 것이라고 가정한다. 3개월 간 체중 감소량의 표준편차는 두 군 모두 5kg이라고 가정한다. 유의수준 0.05에서 양측 t검정을 통해 두 군의 3개월 간 체중 감소량의 평균을 비교할 경우, 80%의 파워(검정력)을 확보하기 위해서 필요한 연구대상자 수는 얼마인가? 단, 등록한 환자 중 20%의 환자는 중도탈락(Loss to follow up)될 것을 감안하여 필요한 연구대상자 수를 계산하시오.
  
  
주어진 사례를 바탕으로 실험을 설계하면 다음과 같다. 
  
귀무가설은 치료군과 대조군의 체중감소량 평균이 동일하다($H_0 : \mu_0 = \mu_1$)이고, 이때 치료군과 대조군의 분산은 25로 같다고 가정한다.($\sigma_0 = \sigma_1 = 5$) 검출하기 위한 두 군의 모평균 차이는 2kg이고(MMD = 2), 유의수준은 0.05($\alpha = 0.05$), 검정력은 80%이다. ($\beta = 0.2$) 한편 중도탈락률은 0.2이다. (R = 0.2)
  
위 모형을 토대로 계산한 효과크기는 다음과 같다.
$$
Cohen's d = \frac{\delta}{\sigma} = \frac{\mu_0 - \mu_1}{\sigma} = \frac{2}{5} = 0.4
$$
  
이상의 설계내용을 바탕으로 2표본 t검정에 필요한 표본수를 계산한 결과는 다음과 같다.
  
```{r 2-1}
library(pwr)
pwr.t.test(d = 0.4, power = 0.8, sig.level = 0.05, type = 'two.sample')
```

표본수 100에 LTF 보정을 하면, 최종적으로 필요한 표본 수는 125명으로 계산된다.
$$
N^* = \frac{N}{1-R} = \frac{100}{0.8} = 125
$$
  
한편, 대응표본 t검정을 실시하는 경우, 중도탈락률까지 감안하면 필요한 표본수는 65명으로 계산된다.

```{r 2-2}
pwr.t.test(d = 0.4, power = 0.8, sig.level = 0.05, type = 'paired')
```
$$
N^* = \frac{N}{1-R} = \frac{52}{0.8} = 65
$$